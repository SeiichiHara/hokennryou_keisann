<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>マンション保険料シミュレーター（逆算機能付き）</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
<div class="container mx-auto px-4 py-8">
<div class="max-w-4xl mx-auto">
<h1 class="text-3xl font-bold text-center text-gray-800 mb-8">
<i class="fas fa-building text-blue-600"></i>
マンション保険料シミュレーター（地震保険料を除く）
</h1>

<!-- 入力フォーム -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
<h2 class="text-xl font-semibold mb-4 text-gray-700">
<i class="fas fa-edit text-green-600"></i>
入力項目
</h2>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<!-- マンション戸数 -->
<div class="space-y-2">
<label class="block text-sm font-medium text-gray-700">
<i class="fas fa-home"></i>
マンション戸数
</label>
<div class="flex gap-2">
<input 
type="number" 
id="units" 
class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
placeholder="戸数を入力"
min="1"
step="1"
>
<button 
id="lockUnitsBtn" 
class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
onclick="toggleUnitsLock()"
>
<i class="fas fa-lock"></i>
固定
</button>
</div>
<p id="unitsStatus" class="text-sm text-gray-500"></p>
<p id="appliedRateInfo" class="text-sm text-blue-600 font-semibold hidden">
<i class="fas fa-info-circle"></i>
<span id="appliedRateText"></span>
</p>
</div>

<!-- 事故件数 -->
<div class="space-y-2">
<label class="block text-sm font-medium text-gray-700">
<i class="fas fa-exclamation-triangle"></i>
事故件数
</label>
<input 
type="number" 
id="accidents" 
class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
placeholder="事故件数を入力"
min="0"
step="1"
oninput="calculate()"
>
</div>

<!-- 保険料 -->
<div class="space-y-2 md:col-span-2">
<label class="block text-sm font-medium text-gray-700">
<i class="fas fa-yen-sign"></i>
<span class="text-red-600 font-semibold">事故件数0件適用の地震保険料を除いた保険料を入力</span>
</label>
<input 
type="number" 
id="zeroAccidentPremium" 
class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
placeholder="事故件数0件適用の保険料を入力（円）"
min="0"
step="1"
oninput="calculateOriginalPremium()"
>
</div>
</div>
</div>

<!-- 適用される割引率表 -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6" id="discountTableSection">
<h2 class="text-xl font-semibold mb-4 text-gray-700">
<i class="fas fa-table text-purple-600"></i>
<span id="tableTitle">保険料割引率表</span>
</h2>

<!-- 20戸以上用の割引率表 -->
<div id="largeDiscountTable" class="hidden">
<div class="overflow-x-auto">
<table class="w-full border-collapse border border-gray-300">
<thead>
<tr class="bg-gray-100">
<th class="border border-gray-300 px-4 py-2 text-left">1戸室あたり事故件数</th>
<th class="border border-gray-300 px-4 py-2 text-center">区分</th>
<th class="border border-gray-300 px-4 py-2 text-center">割引率</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-300 px-4 py-2">0から0.01以下</td>
<td class="border border-gray-300 px-4 py-2 text-center font-semibold text-green-600">S</td>
<td class="border border-gray-300 px-4 py-2 text-center">69%</td>
</tr>
<tr>
<td class="border border-gray-300 px-4 py-2">0.01超から0.03以下</td>
<td class="border border-gray-300 px-4 py-2 text-center font-semibold text-blue-600">A</td>
<td class="border border-gray-300 px-4 py-2 text-center">62%</td>
</tr>
<tr>
<td class="border border-gray-300 px-4 py-2">0.03超から0.05以下</td>
<td class="border border-gray-300 px-4 py-2 text-center font-semibold text-yellow-600">B</td>
<td class="border border-gray-300 px-4 py-2 text-center">53%</td>
</tr>
<tr>
<td class="border border-gray-300 px-4 py-2">0.05超から0.07以下</td>
<td class="border border-gray-300 px-4 py-2 text-center font-semibold text-orange-600">C</td>
<td class="border border-gray-300 px-4 py-2 text-center">36%</td>
</tr>
<tr>
<td class="border border-gray-300 px-4 py-2">0.07超から0.14以下</td>
<td class="border border-gray-300 px-4 py-2 text-center font-semibold text-red-600">D</td>
<td class="border border-gray-300 px-4 py-2 text-center">22%</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- 20戸未満用の割引率表 -->
<div id="smallDiscountTable" class="hidden">
<div class="overflow-x-auto">
<table class="w-full border-collapse border border-gray-300">
<thead>
<tr class="bg-gray-100">
<th class="border border-gray-300 px-4 py-2 text-left">事故件数</th>
<th class="border border-gray-300 px-4 py-2 text-center">割引率</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-300 px-4 py-2">0件</td>
<td class="border border-gray-300 px-4 py-2 text-center">35%</td>
</tr>
<tr>
<td class="border border-gray-300 px-4 py-2">1件以上</td>
<td class="border border-gray-300 px-4 py-2 text-center">0%（割引なし）</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<!-- 計算結果 -->
<div class="bg-white rounded-lg shadow-md p-6">
<h2 class="text-xl font-semibold mb-4 text-gray-700">
<i class="fas fa-calculator text-orange-600"></i>
シミュレーション結果
</h2>

<div class="mb-6 bg-yellow-50 p-4 rounded-lg">
<h3 class="font-semibold text-yellow-800">割引前の純保険料（逆算）</h3>
<p class="text-2xl font-bold text-yellow-600" id="originalPremium">-</p>
<p class="text-sm text-yellow-700 mt-1">
<i class="fas fa-info-circle"></i>
事故件数0件適用の保険料から割引前の保険料を逆算した金額
</p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="space-y-4" id="largeConditionResults">
<div class="bg-blue-50 p-4 rounded-lg">
<h3 class="font-semibold text-blue-800">1戸室あたりの事故件数</h3>
<p class="text-2xl font-bold text-blue-600" id="accidentsPerUnit">-</p>
</div>

<div class="bg-green-50 p-4 rounded-lg">
<h3 class="font-semibold text-green-800">適用される区分</h3>
<p class="text-2xl font-bold text-green-600" id="grade">-</p>
</div>
</div>

<div class="space-y-4" id="smallConditionResults">
<div class="bg-blue-50 p-4 rounded-lg">
<h3 class="font-semibold text-blue-800">事故件数条件</h3>
<p class="text-2xl font-bold text-blue-600" id="accidentCondition">-</p>
</div>
</div>

<div class="space-y-4 md:col-span-2">
<div class="bg-purple-50 p-4 rounded-lg">
<h3 class="font-semibold text-purple-800">適用される割引率</h3>
<p class="text-2xl font-bold text-purple-600" id="discountRate">-</p>
</div>

<div class="bg-red-50 p-4 rounded-lg">
<h3 class="font-semibold text-red-800">割引後の保険料</h3>
<p class="text-3xl font-bold text-red-600" id="discountedPremium">-</p>
</div>

<div class="bg-green-50 p-4 rounded-lg">
<h3 class="font-semibold text-green-800">割引金額</h3>
<p class="text-2xl font-bold text-green-600" id="discountAmount">-</p>
</div>
</div>
</div>
</div>
</div>
</div>

<script>
let unitsLocked = false;
let isLargeProperty = false; // 20戸以上かどうかのフラグ
let originalPremium = 0; // 割引前の純保険料

function toggleUnitsLock() {
const unitsInput = document.getElementById('units');
const lockBtn = document.getElementById('lockUnitsBtn');
const statusText = document.getElementById('unitsStatus');
const appliedRateInfo = document.getElementById('appliedRateInfo');
const appliedRateText = document.getElementById('appliedRateText');

if (!unitsLocked) {
// 戸数が入力されていない場合は固定できない
if (!unitsInput.value || unitsInput.value <= 0) {
alert('戸数を入力してから固定してください。');
return;
}

// 固定する
unitsLocked = true;
isLargeProperty = parseInt(unitsInput.value) >= 20;

unitsInput.disabled = true;
unitsInput.classList.add('bg-gray-100');
lockBtn.innerHTML = '<i class="fas fa-unlock"></i> 解除';
lockBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
lockBtn.classList.add('bg-red-600', 'hover:bg-red-700');
statusText.textContent = '戸数が固定されました。解除ボタンで再入力が可能です。';
statusText.classList.remove('text-gray-500');
statusText.classList.add('text-green-600');

// 戸数に応じて適用率情報を表示
if (isLargeProperty) {
appliedRateText.textContent = '20戸以上のマンション: 事故0件時の適用率は31%（逆算係数: ÷0.31）';
document.getElementById('largeDiscountTable').classList.remove('hidden');
document.getElementById('smallDiscountTable').classList.add('hidden');
document.getElementById('tableTitle').textContent = '保険料割引率表（20戸以上）';
document.getElementById('largeConditionResults').classList.remove('hidden');
document.getElementById('smallConditionResults').classList.add('hidden');
} else {
appliedRateText.textContent = '20戸未満のマンション: 事故0件時の適用率は65%（逆算係数: ÷0.65）';
document.getElementById('smallDiscountTable').classList.remove('hidden');
document.getElementById('largeDiscountTable').classList.add('hidden');
document.getElementById('tableTitle').textContent = '保険料割引率表（20戸未満）';
document.getElementById('smallConditionResults').classList.remove('hidden');
document.getElementById('largeConditionResults').classList.add('hidden');
}

appliedRateInfo.classList.remove('hidden');

// 保険料が入力されていれば計算実行
calculateOriginalPremium();
} else {
// 固定を解除する
unitsLocked = false;
unitsInput.disabled = false;
unitsInput.classList.remove('bg-gray-100');
lockBtn.innerHTML = '<i class="fas fa-lock"></i> 固定';
lockBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
lockBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
statusText.textContent = '戸数の固定が解除されました。';
statusText.classList.remove('text-green-600');
statusText.classList.add('text-gray-500');

// 適用率情報を非表示
appliedRateInfo.classList.add('hidden');

// 両方の表を非表示
document.getElementById('largeDiscountTable').classList.add('hidden');
document.getElementById('smallDiscountTable').classList.add('hidden');

// 結果をクリア
clearResults();
}
}

function calculateOriginalPremium() {
// 事故件数0件適用の保険料から元の保険料を逆算
const zeroAccidentPremium = parseFloat(document.getElementById('zeroAccidentPremium').value);

if (isNaN(zeroAccidentPremium) || zeroAccidentPremium < 0 || !unitsLocked) {
originalPremium = 0;
document.getElementById('originalPremium').textContent = '-';
clearResults();
return;
}

// 戸数に応じて逆算
if (isLargeProperty) {
// 20戸以上: 事故0件は69%割引 → 31%の適用率
originalPremium = Math.round(zeroAccidentPremium / 0.31);
} else {
// 20戸未満: 事故0件は35%割引 → 65%の適用率
originalPremium = Math.round(zeroAccidentPremium / 0.65);
}

document.getElementById('originalPremium').textContent = originalPremium.toLocaleString() + '円';

// 事故件数が入力されていれば計算実行
calculate();
}

function calculate() {
const units = parseInt(document.getElementById('units').value);
const accidents = parseInt(document.getElementById('accidents').value);

// 戸数が固定されていない、または割引前純保険料が計算されていない場合は計算しない
if (!unitsLocked || originalPremium <= 0 || isNaN(accidents) || accidents < 0) {
clearResultsExceptOriginal();
return;
}

let discountRate, grade, discountedPremium, discountAmount;

// 20戸以上と20戸未満で分岐
if (isLargeProperty) {
// 20戸以上: 1戸室あたりの事故件数に応じた割引
const accidentsPerUnit = accidents / units;
document.getElementById('accidentsPerUnit').textContent = accidentsPerUnit.toFixed(4);

// 区分と割引率を決定
if (accidentsPerUnit <= 0.01) {
grade = 'S';
discountRate = 0.69;
} else if (accidentsPerUnit <= 0.03) {
grade = 'A';
discountRate = 0.62;
} else if (accidentsPerUnit <= 0.05) {
grade = 'B';
discountRate = 0.53;
} else if (accidentsPerUnit <= 0.07) {
grade = 'C';
discountRate = 0.36;
} else if (accidentsPerUnit <= 0.14) {
grade = 'D';
discountRate = 0.22;
} else {
grade = '適用外';
discountRate = 0;
}

document.getElementById('grade').textContent = grade;
} else {
// 20戸未満: 事故件数0件かどうかで割引
if (accidents === 0) {
discountRate = 0.35;
document.getElementById('accidentCondition').textContent = '0件（割引あり）';
} else {
discountRate = 0;
document.getElementById('accidentCondition').textContent = accidents + '件（割引なし）';
}
}

// 割引後の保険料と割引金額を計算
discountedPremium = Math.round(originalPremium * (1 - discountRate));
discountAmount = originalPremium - discountedPremium;

// 結果を表示
document.getElementById('discountRate').textContent = discountRate === 0 ? '0%' : (discountRate * 100).toFixed(0) + '%';
document.getElementById('discountedPremium').textContent = discountedPremium.toLocaleString() + '円';
document.getElementById('discountAmount').textContent = discountAmount.toLocaleString() + '円';
}

function clearResults() {
document.getElementById('originalPremium').textContent = '-';
clearResultsExceptOriginal();
}

function clearResultsExceptOriginal() {
document.getElementById('accidentsPerUnit').textContent = '-';
document.getElementById('grade').textContent = '-';
document.getElementById('accidentCondition').textContent = '-';
document.getElementById('discountRate').textContent = '-';
document.getElementById('discountedPremium').textContent = '-';
document.getElementById('discountAmount').textContent = '-';
}
</script>
</body>
</html>
